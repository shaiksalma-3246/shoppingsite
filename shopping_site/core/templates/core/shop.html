{% extends 'core/base.html' %}
{% block content %}
  <h1>Shop</h1>

  <form method="get" action="{% url 'shop' %}" class="search-form">
    <input type="text" name="q" placeholder="Search products..." value="{{ query }}">
    <select name="category">
      <option value="">All Categories</option>
      {% for key, value in categories %}
        <option value="{{ key }}" {% if selected_category == key %}selected{% endif %}>{{ value }}</option>
      {% endfor %}
    </select>
    <button type="submit">Search</button>
  </form>

  <div class="products">
    {% for product in products %}
      <div class="product-card">
        <img src="{{ product.image_url }}" alt="{{ product.name }}" />
        <h3>{{ product.name }}</h3>
        {% if product.discount_price %}
          <p><span class="old-price">₹{{ product.price }}</span> <span class="discount-price">₹{{ product.discount_price }}</span></p>
        {% else %}
          <p>₹{{ product.price }}</p>
        {% endif %}
        <a class="btn" href="{% url 'add_to_cart' product.id %}">Add to Cart</a>
      </div>
    {% empty %}
      <p>No products found.</p>
    {% endfor %}
  </div>
{% endblock %}
